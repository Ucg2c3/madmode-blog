date: 2006-06-29
title: 'converting vcard .vcf syntax to hcard and catching up on CALSIFY'
published: True
tags: ['breadcrumbs']

<div>  <p>A while back I wrote about <cite><a href="/breadcrumbs/node/99">using JSON and templates to produce microformat data</a></cite>. I swapped some of those ideas in today while trying to figure out a simple, consistent model for recurring events using floating times plus locations.</p>  <p>I spent a little time catching up on the <a href="http://www.ietf.org/html.charters/calsify-charter.html">IETF CALSIFY WG</a>; they meet Wednesday, July 12 at 9am in Montreal.  I wonder how much progress they&#39;ll make on issues like the <a href="http://lists.osafoundation.org/pipermail/ietf-calsify/2006-June/001003.html">March 2007 DST change</a> and the <a href="http://lists.osafoundation.org/pipermail/ietf-calsify/2006-May/000967.html">CalConnect recommendations</a> toward an IANA timezone registry.</p>  <p>When I realized I didn&#39;t have a clear problem or use case in mind, I went looking for something that I could chew on in test-driven style.</p>  <p>So I picked up the <a href="http://microformats.org/wiki/hcard-tests">hcard tests</a> and built a vcard-to-hcard converter sort of out of spare parts.  <a href="http://www.w3.org/2002/12/cal/icslex.py">icslex.py</a> handles low-level lexical details of iCalendar, which turn out to have lots in common with vCard: line breaking, escaping, that sort of thing. On top of that, I wrote <a href="http://www.w3.org/2002/12/cal/vcardin.py">vcardin.py</a>, which has enough vcard schema smarts to break down the structured N and ADR and GEO properties so there&#39;s no microparsing below the <a href="http://www.json.org/">JSON</a> level. Then <a href="http://www.w3.org/2002/12/cal/contacts.kid">contacts.kid</a> is a <a href="http://lesscode.org/projects/kid/">kid</a> template that spits out the data following the <a href="http://microformats.org/wiki/hcard">hcard</a> spec.</p>  <p>It works like this:</p> <pre>python vcardin.py contacts.kid hcard/01-tantek-basic.vcf &gt;,01.html<br /></pre>  <p>Then I used X2V to convert the results back to .vcf format and compared them using hcard testing tools (normalize.pl and such) fixed the breakage. Lather, rinse, repeat... I have pretty much all the tests working except 16-honorific-additional-multiple.</p>  <p>It really is a pain to set up a loop for the additional-name field when that field is almost never used, let alone used with multiple values. This sort of structure is more natural in XML/XHTML/hCard than in JSON, in a way. And if I change the JSON structure from a string to a list, does that mean the RDF property should use a list/collection? Probably not... I probably don&#39;t need additional-name to be an owl:FunctionalProperty.</p>  <p>Hmm... meanwhile, this contacts.kid template should mesh nicely with my <a href="/breadcrumbs/node/100">wikipedia airport scraping hack</a>... </p>  <p>See also: IRC notes <a href="http://rbach.priv.at/Microformats-IRC/2006-06-28#T205028">from #microformats</a>, <a href="http://chatlogs.planetrdf.com/swig/2006-06-28.html#T14-12-38">from #swig</a>.</p> </div> 